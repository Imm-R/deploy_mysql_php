---
# tasks file for deploy_mysql_php
- name: Install packages
  yum: name={{ packages }}

- name: Install mysql
  yum: name={{ mysql_packages }}

- name: Install PHP
  yum: name={{ php_packages }}

- name: Restart apache
  service: name=httpd state=started enabled=yes

  #- name: Copy phpMyAdmin
  # copy:
  # src: phpMyAdmin-5.1.1-all-languages.tar.gz
  # dest: /home/ec2-user

- name: Make Directory for phpmyadmin
  ansible.builtin.file:
      path: /usr/share/phpmyadmin
      state: directory
      mode: '0755'
      owner: apache
      group: apache

- name: Extract Archive phpMyAdmin
  ansible.builtin.unarchive:
        src: phpMyAdmin-5.1.1-all-languages.zip
        dest: /usr/share/phpmyadmin
        owner: apache
        group: apache
        extra_opts:
          - --strip=1
 #        remote_src: yes

- name: Delete Archve
  file:
    path: /home/ec2-user/phpMyAdmin-5.1.1-all-languages.tar.gz
    state: absent

- name: Make Dirrectory for temp files
  ansible.builtin.file: path={{ item }} state=directory owner=apache group=apache mode=0755
  loop:
   - "/var/lib/phpmyadmin/tmp"
   - "/etc/phpmyadmin"

     #- name: Create directory for phpMyAdmin configuration files
     #  ansible.builtin.file:
     #   path: /etc/phpmyadmin/
     # state: directory
     #    mode: '0755'
     # owner: apache
     # group: apache

- name: Copy configuration file
  copy: src={{ item }} dest={{ conf_folder }}  owner=apache group=apache mode=0755
  loop:
   - "config.inc.php"

- name: Add phpmyamin.conf for apache
  copy: src={{ item }} dest={{ confd_folder }} owner=apache group=apache mode=0755
  loop:
   - "phpmyadmin.conf"

- name: Remove the MySQL test database.
  mysql_db: db=test state=absent

- name: Create a database for bacula.
  mysql_db: "db=bacula state=present"

- name: Add bacula user and all privileges
  mysql_user: name=bacula password='*2D34C81704AD060D038AB7B0540EE0757B93B42B' encrypted=yes priv='*.*:ALL' state=present
